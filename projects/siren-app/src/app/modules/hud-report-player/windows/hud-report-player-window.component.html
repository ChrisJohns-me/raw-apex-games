<app-ui-container
    primaryTitle="Report Player"
    [injectBootstrapCSS]="true"
    [isDesktopWindow]="false"
    [isContentDraggable]="true"
    [position]="{ xPercent: 0, yPercent: 0, xAnchor: 'left', yAnchor: 'middle' }"
    [size]="{ widthPercent: 0.15, heightPercent: 0.5 }"
>
    <div
        class="report-player-container"
        (mouseover)="pauseAutoDismiss()"
        (mouseout)="unpauseAutoDismiss()"
        (mousedown)="cancelAutoDismiss()"
        *ngIf="killedBy && killedBy.name"
    >
        <div class="countdown-bar-container" *ngIf="!isAutoDismissCanceled && !isAutoDismissPaused">
            <app-countdown-bar [endDate]="autoDismissDate"></app-countdown-bar>
        </div>
        <div class="report-player-close">
            <button type="button" class="btn-close" (click)="onDismissClick()"></button>
        </div>

        <div class="report-player-content py-4 px-3">
            <h1 class="report-player-title text-center mb-3">Killed by {{ killedBy.name }}</h1>

            <!-- #region Pre-Report -->
            <div class="row" *ngIf="!startReportForm">
                <div class="col-auto">
                    <button class="btn btn-outline-secondary w-100" type="button" (click)="startReportForm = true">
                        Report to {{ APP_NAME }}
                    </button>
                </div>
                <div class="col">
                    <button class="btn btn-outline-danger w-100" type="button" (click)="onDismissClick()">Dismiss</button>
                </div>
            </div>
            <!-- #endregion -->

            <!-- #region Report Player Form -->
            <div class="" *ngIf="startReportForm">
                <h5>Report a player to the {{ APP_NAME }} database</h5>

                <!-- #region Form -->
                <form [formGroup]="reportForm" *ngIf="!reportingSuccess">
                    <select class="form-select" formControlName="reason">
                        <option value="" selected disabled>Report Reason</option>
                        <option *ngFor="let reportReason of reportReasonOpts" [ngValue]="reportReason[1]">
                            {{ reportReason[0] }}
                        </option>
                    </select>

                    <div class="form-check my-3">
                        <input class="form-check-input" type="checkbox" value="" id="agreement1Checkbox" formControlName="agreement1" />
                        <label class="form-check-label" for="agreement1Checkbox">
                            <small>
                                I {{ myName ? "(" + myName + "), " : "" }} understand that I am reporting the player "{{ killedBy.name }}"{{
                                    friendlySelectedReportReason ? ' for "' + friendlySelectedReportReason + '"' : ""
                                }}
                                to the {{ APP_NAME }} database, and not EA, Respawn, nor to Apex Legends.
                            </small>
                        </label>
                    </div>

                    <div class="form-check my-3">
                        <input class="form-check-input" type="checkbox" value="" id="agreement2Checkbox" formControlName="agreement2" />
                        <label class="form-check-label" for="agreement2Checkbox">
                            <small
                                >I understand that frivolous or malicious reports will delegitimize my future reports to the
                                {{ APP_NAME }} database.</small
                            >
                        </label>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <button
                                class="btn btn-primary w-100"
                                type="button"
                                [disabled]="reportForm.invalid || reportingInProgress"
                                (click)="onSubmitReportClick()"
                            >
                                <ng-container *ngIf="!reportingInProgress">Report to {{ APP_NAME }}</ng-container>
                                <ng-container *ngIf="reportingInProgress">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Submitting Report...</span>
                                    </div>
                                </ng-container>
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-danger w-100" type="button" (click)="onDismissClick()">Cancel</button>
                        </div>
                    </div>
                </form>
                <!-- #endregion -->

                <!-- #region Submission failed -->
                <div class="alert alert-danger my-3" *ngIf="reportingFailed">
                    There was a problem reporting {{ killedBy.name }} to the {{ APP_NAME }} database.<br />
                    {{ reportingFailedMsg }}
                </div>
                <!-- #endregion -->
                <!-- #region Submission succeeded -->
                <ng-container *ngIf="reportingSuccess">
                    <div class="alert alert-success my-3">
                        Thank you for reporting {{ killedBy.name }} to the {{ APP_NAME }} database.<br />
                        Please do not forget to also report the player via the in-game reporting system.<br />
                    </div>
                    <button class="btn btn-primary" (click)="onDismissClick()" type="button">Close</button>
                </ng-container>
                <!-- #endregion -->
            </div>
            <!-- #endregion -->
        </div>
    </div>
</app-ui-container>
